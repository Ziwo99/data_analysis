{
  "analyses": [
    {
      "id": "1",
      "title": "Sales Volume Analysis",
      "context": "Evaluate the overall sales activity within the cafe.",
      "tables": [
        "dirty_cafe_sales"
      ],
      "sub_analyses": [
        {
          "id": "1.1",
          "title": "Total Transactions",
          "why": "To understand the number of transactions processed.",
          "answers": [
            "Total number of transactions."
          ],
          "tables_columns": [
            "dirty_cafe_sales.Transaction ID"
          ],
          "type": "aggregation",
          "code_lines": [
            "# Calculate total number of transactions by counting unique Transaction IDs",
            "result = pd.DataFrame({'Total Transactions': [dirty_cafe_sales['Transaction ID'].nunique()]})"
          ]
        },
        {
          "id": "1.2",
          "title": "Total Units Sold",
          "why": "To measure the volume of items sold.",
          "answers": [
            "Total quantity of items sold."
          ],
          "tables_columns": [
            "dirty_cafe_sales.Quantity"
          ],
          "type": "aggregation",
          "code_lines": [
            "# Calculate total quantity of items sold while skipping NaN values and converting to numeric",
            "result = pd.DataFrame({'Total Units Sold': [pd.to_numeric(dirty_cafe_sales['Quantity'], errors='coerce').sum()]})"
          ]
        },
        {
          "id": "1.3",
          "title": "Total Sales Revenue",
          "why": "To calculate the revenue generated from sales.",
          "answers": [
            "Total revenue from all transactions."
          ],
          "tables_columns": [
            "dirty_cafe_sales.Total Spent"
          ],
          "type": "aggregation",
          "code_lines": [
            "# Calculate total sales revenue while skipping NaN values and converting to numeric",
            "result = pd.DataFrame({'Total Sales Revenue': [pd.to_numeric(dirty_cafe_sales['Total Spent'], errors='coerce').sum()]})"
          ]
        }
      ]
    },
    {
      "id": "2",
      "title": "Item Popularity Analysis",
      "context": "Identify which items are sold most frequently.",
      "tables": [
        "dirty_cafe_sales"
      ],
      "sub_analyses": [
        {
          "id": "2.1",
          "title": "Top Selling Items",
          "why": "To determine the most frequently sold items.",
          "answers": [
            "List of top items by sales volume."
          ],
          "tables_columns": [
            "dirty_cafe_sales.Item",
            "dirty_cafe_sales.Quantity"
          ],
          "type": "aggregation",
          "code_lines": [
            "# Aggregate quantities by item and sort descending to find top-selling items",
            "result = dirty_cafe_sales.groupby('Item')['Quantity'].sum().sort_values(ascending=False).reset_index()"
          ]
        },
        {
          "id": "2.2",
          "title": "Item Revenue Contribution",
          "why": "To assess which items contribute most to revenue.",
          "answers": [
            "Revenue contribution of top items."
          ],
          "tables_columns": [
            "dirty_cafe_sales.Item",
            "dirty_cafe_sales.Total Spent"
          ],
          "type": "aggregation",
          "code_lines": [
            "# Aggregate total spent by item and sort descending to find items with highest revenue contribution",
            "result = dirty_cafe_sales.groupby('Item')['Total Spent'].sum().sort_values(ascending=False).reset_index()"
          ]
        }
      ]
    },
    {
      "id": "3",
      "title": "Payment Method Analysis",
      "context": "Examine the preferred methods of payment utilized by customers.",
      "tables": [
        "dirty_cafe_sales"
      ],
      "sub_analyses": [
        {
          "id": "3.1",
          "title": "Payment Method Distribution",
          "why": "To understand the breakdown of payment methods used.",
          "answers": [
            "Percentage of each payment method used."
          ],
          "tables_columns": [
            "dirty_cafe_sales.Payment Method"
          ],
          "type": "aggregation",
          "code_lines": [
            "# Calculate the distribution of payment methods as a percentage",
            "payment_counts = dirty_cafe_sales['Payment Method'].value_counts(normalize=True) * 100",
            "result = payment_counts.reset_index().rename(columns={'index': 'Payment Method', 'Payment Method': 'Percentage'})"
          ]
        }
      ]
    },
    {
      "id": "4",
      "title": "Location-Based Sales Analysis",
      "context": "Analyze sales performance across different cafe locations.",
      "tables": [
        "dirty_cafe_sales"
      ],
      "sub_analyses": [
        {
          "id": "4.1",
          "title": "Sales by Location",
          "why": "To compare sales performance between locations.",
          "answers": [
            "Total sales for each location."
          ],
          "tables_columns": [
            "dirty_cafe_sales.Location",
            "dirty_cafe_sales.Total Spent"
          ],
          "type": "aggregation",
          "code_lines": [
            "# Calculate total sales by location",
            "result = dirty_cafe_sales.groupby('Location')['Total Spent'].sum().reset_index()"
          ]
        }
      ]
    },
    {
      "id": "5",
      "title": "Temporal Sales Trends",
      "context": "Detect sales patterns over time to aid future forecasting.",
      "tables": [
        "dirty_cafe_sales"
      ],
      "sub_analyses": [
        {
          "id": "5.1",
          "title": "Daily Sales Volume",
          "why": "To analyze how sales vary day-to-day.",
          "answers": [
            "Sales trends over days."
          ],
          "tables_columns": [
            "dirty_cafe_sales.Transaction Date",
            "dirty_cafe_sales.Total Spent"
          ],
          "type": "aggregation",
          "code_lines": [
            "# Convert Transaction Date to datetime and calculate daily sales",
            "dirty_cafe_sales['Transaction Date'] = pd.to_datetime(dirty_cafe_sales['Transaction Date'], errors='coerce')",
            "result = dirty_cafe_sales.groupby(dirty_cafe_sales['Transaction Date'].dt.date)['Total Spent'].sum().reset_index()"
          ]
        },
        {
          "id": "5.2",
          "title": "Monthly Sales Trends",
          "why": "To understand the trends in sales over various months.",
          "answers": [
            "Month-on-month sales performance."
          ],
          "tables_columns": [
            "dirty_cafe_sales.Transaction Date",
            "dirty_cafe_sales.Total Spent"
          ],
          "type": "aggregation",
          "code_lines": [
            "# Group by month and calculate sales trends",
            "dirty_cafe_sales['Transaction Date'] = pd.to_datetime(dirty_cafe_sales['Transaction Date'], errors='coerce')",
            "result = dirty_cafe_sales.groupby(dirty_cafe_sales['Transaction Date'].dt.to_period('M'))['Total Spent'].sum().reset_index()"
          ]
        }
      ]
    }
  ]
}